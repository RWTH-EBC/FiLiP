<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>filip.semantics.ontology_parser.rdfparser &mdash; FiLiP 0.2.4 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/autodoc_pydantic.css" />

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/sphinx_highlight.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../contents.html" class="icon icon-home">
            FiLiP
          </a>
              <div class="version">
                0.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../index.html">FiLiP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/index.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing.html">Contribute as a user</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing.html#contribute-as-a-developer">Contribute as a developer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../about/index.html">About FiLiP</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../contents.html">FiLiP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../contents.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">filip.semantics.ontology_parser.rdfparser</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for filip.semantics.ontology_parser.rdfparser</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Module contains the RDFParser that can create a Vocabulary object out of a</span>
<span class="sd">given ontology&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">import</span> <span class="nn">rdflib</span>

<span class="kn">from</span> <span class="nn">filip.models.base</span> <span class="kn">import</span> <span class="n">LogLevel</span>
<span class="kn">from</span> <span class="nn">filip.semantics.ontology_parser.vocabulary_builder</span> <span class="kn">import</span> <span class="n">VocabularyBuilder</span>
<span class="kn">from</span> <span class="nn">filip.semantics.vocabulary</span> <span class="kn">import</span> <span class="n">Source</span><span class="p">,</span> <span class="n">IdType</span><span class="p">,</span> \
    <span class="n">Vocabulary</span><span class="p">,</span><span class="n">RestrictionType</span><span class="p">,</span> <span class="n">ObjectProperty</span><span class="p">,</span> <span class="n">DataProperty</span><span class="p">,</span> <span class="n">Relation</span><span class="p">,</span> \
    <span class="n">TargetStatement</span><span class="p">,</span> <span class="n">StatementType</span><span class="p">,</span> <span class="n">DatatypeType</span><span class="p">,</span> <span class="n">Datatype</span><span class="p">,</span> <span class="n">Class</span><span class="p">,</span> <span class="n">Individual</span>


<span class="n">specifier_base_iris</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;http://www.w3.org/2002/07/owl&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;http://www.w3.org/XML/1998/namespace&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;http://www.w3.org/2001/XMLSchema&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;http://www.w3.org/2000/01/rdf-schema&quot;</span><span class="p">]</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Defines a set of base iris, that describe elements that belong to the </span>
<span class="sd">description language not the ontology itself</span>
<span class="sd">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="Tags"><a class="viewcode-back" href="../../../../code/filip.semantics.ontology_parser.html#filip.semantics.ontology_parser.rdfparser.Tags">[docs]</a><span class="k">class</span> <span class="nc">Tags</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Collection of tags used as structures in ontologies, that were used more</span>
<span class="sd">    than once in the rdfparser code</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rdf_type</span> <span class="o">=</span> <span class="s1">&#39;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&#39;</span><span class="p">,</span>
    <span class="n">owl_intersection</span> <span class="o">=</span> <span class="s1">&#39;http://www.w3.org/2002/07/owl#intersectionOf&#39;</span><span class="p">,</span>
    <span class="n">owl_union</span> <span class="o">=</span> <span class="s1">&#39;http://www.w3.org/2002/07/owl#unionOf&#39;</span><span class="p">,</span>
    <span class="n">owl_one_of</span> <span class="o">=</span> <span class="s1">&#39;http://www.w3.org/2002/07/owl#oneOf&#39;</span><span class="p">,</span>
    <span class="n">owl_individual</span> <span class="o">=</span> <span class="s1">&#39;http://www.w3.org/2002/07/owl#NamedIndividual&#39;</span><span class="p">,</span>
    <span class="n">owl_on_class</span> <span class="o">=</span> <span class="s1">&#39;http://www.w3.org/2002/07/owl#onClass&#39;</span><span class="p">,</span>
    <span class="n">owl_on_data_range</span> <span class="o">=</span> <span class="s1">&#39;http://www.w3.org/2002/07/owl#onDataRange&#39;</span></div>


<div class="viewcode-block" id="get_iri_from_uriref"><a class="viewcode-back" href="../../../../code/filip.semantics.ontology_parser.html#filip.semantics.ontology_parser.rdfparser.get_iri_from_uriref">[docs]</a><span class="k">def</span> <span class="nf">get_iri_from_uriref</span><span class="p">(</span><span class="n">uriref</span><span class="p">:</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">URIRef</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Give an Uriref object, returns an iri</span>

<span class="sd">    Args:</span>
<span class="sd">        uriref: Object describing the iri</span>

<span class="sd">    Returns:</span>
<span class="sd">        str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">uriref</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_base_out_of_iri"><a class="viewcode-back" href="../../../../code/filip.semantics.ontology_parser.html#filip.semantics.ontology_parser.rdfparser.get_base_out_of_iri">[docs]</a><span class="k">def</span> <span class="nf">get_base_out_of_iri</span><span class="p">(</span><span class="n">iri</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Give an iri, returns an the ontology base name</span>

<span class="sd">       Args:</span>
<span class="sd">           iri</span>

<span class="sd">       Returns:</span>
<span class="sd">           str</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;#&quot;</span> <span class="ow">in</span> <span class="n">iri</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">iri</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">iri</span><span class="p">[:</span><span class="n">index</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># for example if uri looks like:</span>
        <span class="c1"># http://webprotege.stanford.edu/RDwpQ8vbi7HaApq8VoqJUXH</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">iri</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">iri</span><span class="p">[:</span><span class="n">index</span><span class="p">]</span></div>


<div class="viewcode-block" id="RdfParser"><a class="viewcode-back" href="../../../../code/filip.semantics.ontology_parser.html#filip.semantics.ontology_parser.rdfparser.RdfParser">[docs]</a><span class="k">class</span> <span class="nc">RdfParser</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class that parses a given source into a vocabulary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_source</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Current source which is parsed, used for Log entries&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_class_iri</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iri of class which is currently parsed, used for Log entries&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_add_logging_information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span><span class="p">,</span>
                                 <span class="n">entity_type</span><span class="p">:</span> <span class="n">IdType</span><span class="p">,</span> <span class="n">entity_iri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                 <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add an entry to the parsing log</span>

<span class="sd">        Args:</span>
<span class="sd">            level (LogLevel): severe, warning or info</span>
<span class="sd">            entity_type (IdType)</span>
<span class="sd">            entity_iri (str)</span>
<span class="sd">            msg (str): Message to inform the user about the occurred issue</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_source</span><span class="o">.</span><span class="n">add_parsing_log_entry</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span>
                                                      <span class="n">entity_iri</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

<div class="viewcode-block" id="RdfParser.parse_source_into_vocabulary"><a class="viewcode-back" href="../../../../code/filip.semantics.ontology_parser.html#filip.semantics.ontology_parser.rdfparser.RdfParser.parse_source_into_vocabulary">[docs]</a>    <span class="k">def</span> <span class="nf">parse_source_into_vocabulary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Source</span><span class="p">,</span>
                                     <span class="n">vocabulary</span><span class="p">:</span> <span class="n">Vocabulary</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Parse a Source into the given vocabulary</span>
<span class="sd">        Args:</span>
<span class="sd">            source (Source)</span>
<span class="sd">            vocabulary (Vocabulary)</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool, True if success, False if Error occurred, as an invalid File</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># if this is the predefined source don&#39;t parse it, just pretend it</span>
        <span class="c1"># was successful</span>
        <span class="k">if</span> <span class="n">source</span><span class="o">.</span><span class="n">predefined</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="n">voc_builder</span> <span class="o">=</span> <span class="n">VocabularyBuilder</span><span class="p">(</span><span class="n">vocabulary</span><span class="o">=</span><span class="n">vocabulary</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>

        <span class="c1"># format = rdflib.util.guess_format(source.source_path)</span>
        <span class="n">voc_builder</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="n">voc_builder</span><span class="o">.</span><span class="n">set_current_source</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="n">g</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;turtle&quot;</span><span class="p">)</span>

        <span class="n">ontology_nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">subjects</span><span class="p">(</span>
            <span class="nb">object</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="s2">&quot;http://www.w3.org/2002/07/owl#Ontology&quot;</span><span class="p">),</span>
            <span class="n">predicate</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">rdf_type</span><span class="o">.</span><span class="n">value</span><span class="p">)))</span>

        <span class="c1"># a source may have no ontology iri defined</span>
        <span class="c1"># if wanted on this place more info about the ontology can be extracted</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ontology_nodes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">source</span><span class="o">.</span><span class="n">ontology_iri</span> <span class="o">=</span> <span class="n">get_iri_from_uriref</span><span class="p">(</span><span class="n">ontology_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_source</span> <span class="o">=</span> <span class="n">source</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_to_vocabulary</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">voc_builder</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">_is_object_defined_by_other_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="p">,</span>
                                           <span class="n">graph</span><span class="p">:</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">Graph</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test if the term is defined outside the current source</span>

<span class="sd">        Args:</span>
<span class="sd">            a (rdflib.term): Term to check</span>
<span class="sd">            graph (rdflib.graph): graph extracted from source</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># if an object is defined by an other source it carries the predicate</span>
        <span class="c1"># (&quot;isDefinedBy&quot;). Then don&#39;t parse the object</span>
        <span class="n">defined_tags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span>
            <span class="n">subject</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span>
                <span class="s2">&quot;http://www.w3.org/2000/01/rdf-schema#isDefinedBy&quot;</span><span class="p">)))</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">defined_tags</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_parse_to_vocabulary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span>
                             <span class="n">voc_builder</span><span class="p">:</span> <span class="n">VocabularyBuilder</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse an graph that was extracted from a TTL file into the vocabulary</span>

<span class="sd">        Args:</span>
<span class="sd">            graph (rdflib.Graph)</span>
<span class="sd">            voc_builder (VocabularyBuilder): Builder object to manipulate a</span>
<span class="sd">                vocabulary</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># OWLClasses</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">subjects</span><span class="p">(</span>
                <span class="nb">object</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span>
                    <span class="s2">&quot;http://www.w3.org/2002/07/owl#Class&quot;</span><span class="p">),</span>
                <span class="n">predicate</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">rdf_type</span><span class="o">.</span><span class="n">value</span><span class="p">)):</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">BNode</span><span class="p">):</span>
                <span class="k">pass</span>
                <span class="c1"># owl:Class can also occure in complex target statements of</span>
                <span class="c1"># relations as BNode, ignore it here</span>
            <span class="k">else</span><span class="p">:</span>

                <span class="c1"># defined in other source -&gt; ignore</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_object_defined_by_other_source</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="n">iri</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_annotations</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">iri</span><span class="o">=</span><span class="n">iri</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span>
                <span class="n">voc_builder</span><span class="o">.</span><span class="n">add_class</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>

        <span class="c1"># Class properties</span>
        <span class="n">found_class_iris</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">class_node</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">subjects</span><span class="p">(</span>
                <span class="n">predicate</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span>
                    <span class="s2">&quot;http://www.w3.org/2000/01/rdf-schema#subClassOf&quot;</span><span class="p">)):</span>

            <span class="n">class_iri</span> <span class="o">=</span> <span class="n">get_iri_from_uriref</span><span class="p">(</span><span class="n">class_node</span><span class="p">)</span>
            <span class="n">found_class_iris</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">class_iri</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">class_iri</span> <span class="ow">in</span> <span class="n">found_class_iris</span><span class="p">:</span>
            <span class="c1"># parent class / relation parsing</span>
            <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span>
                    <span class="n">subject</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">class_iri</span><span class="p">),</span>
                    <span class="n">predicate</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span>
                        <span class="p">(</span><span class="s1">&#39;http://www.w3.org/2000/01/rdf-schema#subClassOf&#39;</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_class_iri</span> <span class="o">=</span> <span class="n">class_iri</span>  <span class="c1"># used only for logging</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parse_subclass_term</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">,</span>
                                          <span class="n">voc_builder</span><span class="o">=</span><span class="n">voc_builder</span><span class="p">,</span>
                                          <span class="n">node</span><span class="o">=</span><span class="n">sub</span><span class="p">,</span>
                                          <span class="n">class_iri</span><span class="o">=</span><span class="n">class_iri</span><span class="p">)</span>

        <span class="c1"># OWlObjectProperties</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">subjects</span><span class="p">(</span>
                <span class="nb">object</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span>
                    <span class="s2">&quot;http://www.w3.org/2002/07/owl#ObjectProperty&quot;</span><span class="p">),</span>
                <span class="n">predicate</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">rdf_type</span><span class="o">.</span><span class="n">value</span><span class="p">)):</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">BNode</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_logging_information</span><span class="p">(</span><span class="n">LogLevel</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span>
                                              <span class="n">IdType</span><span class="o">.</span><span class="n">object_property</span><span class="p">,</span>
                                              <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
                                              <span class="s2">&quot;Found unparseable statement&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># defined in other source -&gt; ignore</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_object_defined_by_other_source</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="n">iri</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_annotations</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

                <span class="n">obj_prop</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="n">iri</span><span class="o">=</span><span class="n">iri</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span>
                <span class="n">voc_builder</span><span class="o">.</span><span class="n">add_object_property</span><span class="p">(</span><span class="n">obj_prop</span><span class="p">)</span>
                <span class="c1"># extract inverse properties, it can be multiple but only</span>
                <span class="c1"># URIRefs allowed no union/intersection</span>
                <span class="k">for</span> <span class="n">inverse_iri_node</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
                        <span class="n">predicate</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span>
                        <span class="s1">&#39;http://www.w3.org/2002/07/owl#inverseOf&#39;</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inverse_iri_node</span><span class="p">,</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">BNode</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_add_logging_information</span><span class="p">(</span>
                            <span class="n">LogLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span> <span class="n">IdType</span><span class="o">.</span><span class="n">object_property</span><span class="p">,</span> <span class="n">iri</span><span class="p">,</span>
                            <span class="s2">&quot;Complex inverseProperty statements aren&#39;t allowed&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">inverse_iri</span> <span class="o">=</span> <span class="n">get_iri_from_uriref</span><span class="p">(</span><span class="n">inverse_iri_node</span><span class="p">)</span>
                        <span class="n">obj_prop</span><span class="o">.</span><span class="n">add_inverse_property_iri</span><span class="p">(</span><span class="n">inverse_iri</span><span class="p">)</span>

        <span class="c1"># OWlDataProperties</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">subjects</span><span class="p">(</span>
                <span class="nb">object</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span>
                    <span class="s2">&quot;http://www.w3.org/2002/07/owl#DatatypeProperty&quot;</span><span class="p">),</span>
                <span class="n">predicate</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">rdf_type</span><span class="o">.</span><span class="n">value</span><span class="p">)):</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">BNode</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_logging_information</span><span class="p">(</span><span class="n">LogLevel</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span>
                                              <span class="n">IdType</span><span class="o">.</span><span class="n">data_property</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
                                             <span class="s2">&quot;Found unparseable statement&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># defined in other source -&gt; ignore</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_object_defined_by_other_source</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="n">iri</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_annotations</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

                <span class="n">data_prop</span> <span class="o">=</span> <span class="n">DataProperty</span><span class="p">(</span><span class="n">iri</span><span class="o">=</span><span class="n">iri</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span>
                <span class="n">voc_builder</span><span class="o">.</span><span class="n">add_data_property</span><span class="p">(</span><span class="n">data_prop</span><span class="p">)</span>

        <span class="c1"># OWLDataTypes</span>
        <span class="c1"># only the custom created datatype_catalogue are listed in the file,</span>
        <span class="c1"># the predefined are automatically added at the start</span>
        <span class="c1"># of post processing</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">subjects</span><span class="p">(</span>
                <span class="nb">object</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span>
                    <span class="s2">&quot;http://www.w3.org/2000/01/rdf-schema#Datatype&quot;</span><span class="p">),</span>
                <span class="n">predicate</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">rdf_type</span><span class="o">.</span><span class="n">value</span><span class="p">)):</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">BNode</span><span class="p">):</span>
                <span class="c1"># self._add_logging_information(LogLevel.WARNING,</span>
                <span class="c1">#                              IdType.datatype, &quot;unknown&quot;,</span>
                <span class="c1">#                              &quot;Found unparseable statement&quot;)</span>
                <span class="k">pass</span>
                <span class="c1">#e.g: :</span>
                <span class="c1"># customDataType4 rdf:type rdfs:Datatype ;</span>
                <span class="c1"># owl:equivalentClass [ rdf:type rdfs:Datatype ;....</span>
                <span class="c1"># the second Datatype triggers this if condition,</span>
                <span class="c1"># but we can ignore this statement</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># defined in other source -&gt; ignore</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_object_defined_by_other_source</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="n">iri</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_annotations</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

                <span class="n">datatype</span> <span class="o">=</span> <span class="n">Datatype</span><span class="p">(</span><span class="n">iri</span><span class="o">=</span><span class="n">iri</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span>
                <span class="n">voc_builder</span><span class="o">.</span><span class="n">add_datatype</span><span class="p">(</span><span class="n">datatype</span><span class="o">=</span><span class="n">datatype</span><span class="p">)</span>

                <span class="c1"># a datatype can be empty -&gt; use string</span>
                <span class="c1"># a datatype can have multiple equivalent classes</span>
                <span class="c1"># (predefined types) -&gt; ignore for now</span>
                <span class="c1"># a datatype can contain an enum of possible values -&gt;</span>
                <span class="c1"># most interesting</span>
                <span class="c1"># under the predicate owl:equivalentClass is than a</span>
                <span class="c1"># list(first, rest, nil) under the pred.</span>
                <span class="c1"># oneOf with the values</span>

                <span class="n">enum_values</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">equivalent_class</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span>
                        <span class="n">subject</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
                        <span class="n">predicate</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span>
                            <span class="s2">&quot;http://www.w3.org/2002/07/owl#equivalentClass&quot;</span><span class="p">)):</span>

                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">equivalent_class</span><span class="p">,</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">):</span>
                        <span class="c1"># points to an other defined datatype, ignore</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># is a bNode and points to owl:oneOf</span>
                        <span class="n">enum_literals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>\
                            <span class="n">_extract_objects_out_of_single_combination</span><span class="p">(</span>
                                <span class="n">graph</span><span class="p">,</span> <span class="n">equivalent_class</span><span class="p">,</span> <span class="n">accept_and</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">accept_or</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">accept_one_of</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">literal</span> <span class="ow">in</span> <span class="n">enum_literals</span><span class="p">:</span>
                            <span class="n">enum_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">literal</span><span class="p">))</span>
                <span class="n">datatype</span><span class="o">.</span><span class="n">enum_values</span> <span class="o">=</span> <span class="n">enum_values</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">enum_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">datatype</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">DatatypeType</span><span class="o">.</span><span class="n">enum</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">datatype</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">DatatypeType</span><span class="o">.</span><span class="n">string</span>

        <span class="c1"># OWLIndividuals</span>

        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">subjects</span><span class="p">(</span>
                <span class="nb">object</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">owl_individual</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                <span class="n">predicate</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">rdf_type</span><span class="o">.</span><span class="n">value</span><span class="p">)):</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">BNode</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_logging_information</span><span class="p">(</span><span class="n">LogLevel</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span>
                                              <span class="n">IdType</span><span class="o">.</span><span class="n">individual</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
                                             <span class="s2">&quot;Found unparseable statement&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># defined in other source -&gt; ignore</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_object_defined_by_other_source</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="n">iri</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_annotations</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                <span class="n">objects</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
                                        <span class="n">predicate</span><span class="o">=</span>
                                        <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">rdf_type</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
                <span class="c1"># superclasses = types</span>
                <span class="n">types</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="nb">object</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">object</span> <span class="o">==</span> \
                           <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">owl_individual</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
                        <span class="n">types</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span>
                            <span class="n">_extract_objects_out_of_layered_combination</span><span class="p">(</span>
                                        <span class="n">graph</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>

                <span class="n">individual</span> <span class="o">=</span> <span class="n">Individual</span><span class="p">(</span><span class="n">iri</span><span class="o">=</span><span class="n">iri</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span>
                <span class="k">for</span> <span class="nb">type</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
                    <span class="n">individual</span><span class="o">.</span><span class="n">parent_class_iris</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">get_iri_from_uriref</span><span class="p">(</span><span class="nb">type</span><span class="p">))</span>
                <span class="n">voc_builder</span><span class="o">.</span><span class="n">add_individual</span><span class="p">(</span><span class="n">individual</span><span class="o">=</span><span class="n">individual</span><span class="p">)</span>

        <span class="c1"># As seen for example in the bricks ontology an individual can be</span>
        <span class="c1"># declared with :individual1 rdf:type :Class1</span>
        <span class="c1"># this type of declaration is hard to completly detect</span>
        <span class="c1"># we need to see that the object is a class iri and not a specifier iri.</span>
        <span class="c1"># as we may not have loaded all dependencies we can not simply look it</span>
        <span class="c1"># up in vocabulary</span>
        <span class="c1"># -&gt; getbase uri of statement and filter all known specifier uris</span>
        <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">subjects</span><span class="p">(</span>
                <span class="n">predicate</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">rdf_type</span><span class="o">.</span><span class="n">value</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">sub</span><span class="p">,</span>
                                     <span class="n">predicate</span><span class="o">=</span>
                                     <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">rdf_type</span><span class="o">.</span><span class="n">value</span><span class="p">)):</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">BNode</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="n">obj_iri</span> <span class="o">=</span> <span class="n">get_iri_from_uriref</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

                <span class="n">obj_base_iri</span> <span class="o">=</span> <span class="n">get_base_out_of_iri</span><span class="p">(</span><span class="n">iri</span><span class="o">=</span><span class="n">obj_iri</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">obj_base_iri</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">specifier_base_iris</span><span class="p">:</span>
                    <span class="n">iri</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">_extract_annotations</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">sub</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">voc_builder</span><span class="o">.</span><span class="n">entity_is_known</span><span class="p">(</span><span class="n">iri</span><span class="p">):</span>
                        <span class="n">iri</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">_extract_annotations</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">sub</span><span class="p">)</span>
                        <span class="n">individual</span> <span class="o">=</span> <span class="n">Individual</span><span class="p">(</span><span class="n">iri</span><span class="o">=</span><span class="n">iri</span><span class="p">,</span>
                                                <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                                                <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span>
                        <span class="n">individual</span><span class="o">.</span><span class="n">parent_class_iris</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj_iri</span><span class="p">)</span>
                        <span class="n">voc_builder</span><span class="o">.</span><span class="n">add_individual</span><span class="p">(</span><span class="n">individual</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_extract_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span>
                             <span class="n">node</span><span class="p">:</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Extract out of a node term the owl annotations (iri, label, comment)</span>

<span class="sd">        Args:</span>
<span class="sd">            graph (rdflib.graph): Graph describing ontology</span>
<span class="sd">            node (rdflib.term.URIRef): Entity node</span>

<span class="sd">        Returns:</span>
<span class="sd">            [str,str,str]: [iri, label, comment]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">iri</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
        <span class="n">comment</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">comment</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">iri</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">comment</span>

    <span class="k">def</span> <span class="nf">_parse_subclass_term</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span>
                             <span class="n">voc_builder</span><span class="p">:</span> <span class="n">VocabularyBuilder</span><span class="p">,</span>
                             <span class="n">node</span><span class="p">:</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="p">,</span> <span class="n">class_iri</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse a subclass term of the given node and class_iri</span>

<span class="sd">        Args:</span>
<span class="sd">            graph (rdflib.graph): Graph describing ontology</span>
<span class="sd">            vocabulary (Vocabulary): Vocabualry to parse into</span>
<span class="sd">            node (rdflib.term)</span>
<span class="sd">            class_iri (str)</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># class could have been only defined in other source, than no class</span>
        <span class="c1"># is defined, but as we have found a relation for a class, the class</span>
        <span class="c1"># needs to exist</span>
        <span class="k">if</span> <span class="n">class_iri</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">voc_builder</span><span class="o">.</span><span class="n">vocabulary</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="n">voc_builder</span><span class="o">.</span><span class="n">add_class</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="n">Class</span><span class="p">(</span><span class="n">iri</span><span class="o">=</span><span class="n">class_iri</span><span class="p">))</span>

        <span class="c1"># node can be 1 of 3 things:</span>
        <span class="c1">#   - a parentclass statment -&gt; UriRef</span>
        <span class="c1">#   - a relation statment -&gt; BNode</span>
        <span class="c1">#   - an intersection of parentclasses ,</span>
        <span class="c1">#   relations and intersections -&gt; BNode</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">BNode</span><span class="p">):</span>
            <span class="c1"># sub has no IRI and is therefore a relation</span>

            <span class="c1"># extract the subpredicates and subobjects as statments</span>
            <span class="c1"># if node is a relation:</span>
            <span class="c1">#      in total there should be 3-4 statments:</span>
            <span class="c1">#      rdf:type pointing to owl:Restriction</span>
            <span class="c1">#      owl:onProperty pointing to a data or object property</span>
            <span class="c1">#      1-2 staments which values are exepted, this can point to an</span>
            <span class="c1">#      URIRef or BNode</span>

            <span class="c1"># if node is a intersection:</span>
            <span class="c1">#      it has the predicate owl:intersectionOf</span>
            <span class="c1">#      and a set of objects</span>

            <span class="n">predicates</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">objects</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">predicates</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">node</span><span class="p">):</span>
                <span class="n">predicates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">node</span><span class="p">):</span>
                <span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>

            <span class="c1"># Combination of statements</span>
            <span class="k">if</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">owl_intersection</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">predicates</span><span class="p">:</span>
                <span class="n">objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_objects_out_of_single_combination</span><span class="p">(</span>
                    <span class="n">graph</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="k">for</span> <span class="nb">object</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_parse_subclass_term</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">,</span>
                                              <span class="n">voc_builder</span><span class="o">=</span><span class="n">voc_builder</span><span class="p">,</span>
                                              <span class="n">node</span><span class="o">=</span><span class="nb">object</span><span class="p">,</span> <span class="n">class_iri</span><span class="o">=</span><span class="n">class_iri</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">owl_union</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">predicates</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_logging_information</span><span class="p">(</span>
                    <span class="n">LogLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span> <span class="n">IdType</span><span class="o">.</span><span class="n">class_</span><span class="p">,</span> <span class="n">class_iri</span><span class="p">,</span>
                    <span class="s2">&quot;Relation statements combined with or&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">owl_one_of</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">predicates</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_logging_information</span><span class="p">(</span>
                    <span class="n">LogLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span> <span class="n">IdType</span><span class="o">.</span><span class="n">class_</span><span class="p">,</span> <span class="n">class_iri</span><span class="p">,</span>
                    <span class="s2">&quot;Relation statements combined with oneOf&quot;</span><span class="p">)</span>

            <span class="c1"># Relation statement</span>
            <span class="k">else</span><span class="p">:</span>

                <span class="n">additional_statements</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">rdf_type</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">owl_on_property</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predicates</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">predicates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">rdf_type</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
                        <span class="n">rdf_type</span> <span class="o">=</span> <span class="n">get_iri_from_uriref</span><span class="p">(</span><span class="n">objects</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="n">predicates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span>
                            <span class="s2">&quot;http://www.w3.org/2002/07/owl#onProperty&quot;</span><span class="p">):</span>
                        <span class="n">owl_on_property</span> <span class="o">=</span> <span class="n">get_iri_from_uriref</span><span class="p">(</span><span class="n">objects</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">additional_statements</span><span class="p">[</span>
                            <span class="n">get_iri_from_uriref</span><span class="p">(</span><span class="n">predicates</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span> <span class="o">=</span> <span class="n">objects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                <span class="n">relation_is_ok</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">rdf_type</span> <span class="o">==</span> <span class="s2">&quot;http://www.w3.org/2002/07/owl#Restriction&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_add_logging_information</span><span class="p">(</span>
                        <span class="n">LogLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span> <span class="n">IdType</span><span class="o">.</span><span class="n">class_</span><span class="p">,</span> <span class="n">class_iri</span><span class="p">,</span>
                        <span class="s2">&quot;Class has an unknown subClass statement&quot;</span><span class="p">)</span>
                    <span class="n">relation_is_ok</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="n">owl_on_property</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_add_logging_information</span><span class="p">(</span>
                        <span class="n">LogLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span> <span class="n">IdType</span><span class="o">.</span><span class="n">class_</span><span class="p">,</span> <span class="n">class_iri</span><span class="p">,</span>
                        <span class="s2">&quot;Class has a relation without a property&quot;</span><span class="p">)</span>
                    <span class="n">relation_is_ok</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="c1"># object or data relation?</span>
                <span class="k">if</span> <span class="n">relation_is_ok</span><span class="p">:</span>
                    <span class="n">relation</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="nb">id</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span>
                    <span class="c1"># this id can and should be random. a class_iri can have a</span>
                    <span class="c1"># property_iri multiple times, to assign always the same id</span>
                    <span class="c1"># for the same relation is not worth the trouble</span>

                    <span class="n">relation</span> <span class="o">=</span> <span class="n">Relation</span><span class="p">(</span><span class="n">property_iri</span><span class="o">=</span><span class="n">owl_on_property</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
                    <span class="n">voc_builder</span><span class="o">.</span><span class="n">add_relation_for_class</span><span class="p">(</span><span class="n">class_iri</span><span class="p">,</span> <span class="n">relation</span><span class="p">)</span>

                    <span class="c1"># go through the additional statement to figure out the</span>
                    <span class="c1"># targetIRI and the restrictionType/cardinality</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_parse_relation_type</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">relation</span><span class="p">,</span>
                                              <span class="n">additional_statements</span><span class="p">)</span>

        <span class="c1"># parent-class statement or empty list element</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># owlThing is the root object, but it is not declared as a class</span>
            <span class="c1"># in the file to prevent None pointer when looking up parents,</span>
            <span class="c1"># a class that has a parent owlThing simply has no parents</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">get_iri_from_uriref</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> \
                   <span class="s2">&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#nil&quot;</span><span class="p">:</span>
                <span class="c1"># ignore empty lists</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">get_iri_from_uriref</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> \
                       <span class="s2">&quot;http://www.w3.org/2002/07/owl#Thing&quot;</span><span class="p">:</span>
                    <span class="n">voc_builder</span><span class="o">.</span><span class="n">vocabulary</span><span class="o">.</span>\
                        <span class="n">get_class_by_iri</span><span class="p">(</span><span class="n">class_iri</span><span class="p">)</span><span class="o">.</span><span class="n">parent_class_iris</span><span class="o">.</span>\
                        <span class="n">append</span><span class="p">(</span><span class="n">get_iri_from_uriref</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_parse_relation_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span>
                             <span class="n">relation</span><span class="p">:</span> <span class="n">Relation</span><span class="p">,</span> <span class="n">statements</span><span class="p">:</span> <span class="p">{}):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse the relation type and depending on the result the</span>
<span class="sd">        cardinality or value of relation</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            graph: underlying ontology graph</span>
<span class="sd">            relation: Relation object into which the information are saved</span>
<span class="sd">            statements: Ontology statements concerning the relation</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">treated_statements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">statement</span> <span class="ow">in</span> <span class="n">statements</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">statement</span> <span class="o">==</span> <span class="s2">&quot;http://www.w3.org/2002/07/owl#someValuesFrom&quot;</span><span class="p">:</span>
                <span class="n">relation</span><span class="o">.</span><span class="n">restriction_type</span> <span class="o">=</span> <span class="n">RestrictionType</span><span class="o">.</span><span class="n">some</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parse_relation_values</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">relation</span><span class="p">,</span>
                                            <span class="n">statements</span><span class="p">[</span><span class="n">statement</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">statement</span> <span class="o">==</span> <span class="s2">&quot;http://www.w3.org/2002/07/owl#allValuesFrom&quot;</span><span class="p">:</span>
                <span class="n">relation</span><span class="o">.</span><span class="n">restriction_type</span> <span class="o">=</span> <span class="n">RestrictionType</span><span class="o">.</span><span class="n">only</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parse_relation_values</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">relation</span><span class="p">,</span>
                                            <span class="n">statements</span><span class="p">[</span><span class="n">statement</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">statement</span> <span class="o">==</span> <span class="s2">&quot;http://www.w3.org/2002/07/owl#hasValue&quot;</span><span class="p">:</span>
                <span class="n">relation</span><span class="o">.</span><span class="n">restriction_type</span> <span class="o">=</span> <span class="n">RestrictionType</span><span class="o">.</span><span class="n">value</span>
                <span class="c1"># has Value can only point to a single value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parse_has_value</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">relation</span><span class="p">,</span>
                                      <span class="n">statements</span><span class="p">[</span><span class="n">statement</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">statement</span> <span class="o">==</span> <span class="s2">&quot;http://www.w3.org/2002/07/owl#maxCardinality&quot;</span><span class="p">:</span>
                <span class="n">relation</span><span class="o">.</span><span class="n">restriction_type</span> <span class="o">=</span> <span class="n">RestrictionType</span><span class="o">.</span><span class="n">max</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parse_cardinality</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">relation</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span>
                                        <span class="n">statements</span><span class="p">,</span> <span class="n">treated_statements</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">statement</span> <span class="o">==</span> <span class="s2">&quot;http://www.w3.org/2002/07/owl#minCardinality&quot;</span><span class="p">:</span>
                <span class="n">relation</span><span class="o">.</span><span class="n">restriction_type</span> <span class="o">=</span> <span class="n">RestrictionType</span><span class="o">.</span><span class="n">min</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parse_cardinality</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">relation</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span>
                                        <span class="n">statements</span><span class="p">,</span> <span class="n">treated_statements</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">statement</span> <span class="o">==</span> <span class="s2">&quot;http://www.w3.org/2002/07/owl#cardinality&quot;</span><span class="p">:</span>
                <span class="n">relation</span><span class="o">.</span><span class="n">restriction_type</span> <span class="o">=</span> <span class="n">RestrictionType</span><span class="o">.</span><span class="n">exactly</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parse_cardinality</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span>  <span class="n">relation</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span>
                                        <span class="n">statements</span><span class="p">,</span> <span class="n">treated_statements</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">statement</span> <span class="o">==</span> \
                    <span class="s2">&quot;http://www.w3.org/2002/07/owl#maxQualifiedCardinality&quot;</span><span class="p">:</span>
                <span class="n">relation</span><span class="o">.</span><span class="n">restriction_type</span> <span class="o">=</span> <span class="n">RestrictionType</span><span class="o">.</span><span class="n">max</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parse_cardinality</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">relation</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span>
                                        <span class="n">statements</span><span class="p">,</span> <span class="n">treated_statements</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">statement</span> <span class="o">==</span> \
                    <span class="s2">&quot;http://www.w3.org/2002/07/owl#minQualifiedCardinality&quot;</span><span class="p">:</span>
                <span class="n">relation</span><span class="o">.</span><span class="n">restriction_type</span> <span class="o">=</span> <span class="n">RestrictionType</span><span class="o">.</span><span class="n">min</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parse_cardinality</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">relation</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span>
                                        <span class="n">statements</span><span class="p">,</span> <span class="n">treated_statements</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">statement</span> <span class="o">==</span> \
                    <span class="s2">&quot;http://www.w3.org/2002/07/owl#qualifiedCardinality&quot;</span><span class="p">:</span>
                <span class="n">relation</span><span class="o">.</span><span class="n">restriction_type</span> <span class="o">=</span> <span class="n">RestrictionType</span><span class="o">.</span><span class="n">exactly</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parse_cardinality</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">relation</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span>
                                        <span class="n">statements</span><span class="p">,</span> <span class="n">treated_statements</span><span class="p">)</span>

            <span class="n">treated_statements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">statement</span> <span class="ow">in</span> <span class="n">statements</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">statement</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">treated_statements</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_logging_information</span><span class="p">(</span>
                  <span class="n">LogLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span> <span class="n">IdType</span><span class="o">.</span><span class="n">class_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_class_iri</span><span class="p">,</span>
                  <span class="s2">&quot;Relation with property </span><span class="si">{}</span><span class="s2"> has an untreated restriction &quot;</span>
                  <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">relation</span><span class="o">.</span><span class="n">property_iri</span><span class="p">,</span> <span class="n">statement</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_parse_cardinality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span>
                           <span class="n">relation</span><span class="p">:</span> <span class="n">Relation</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">statements</span><span class="p">,</span>
                           <span class="n">treated_statements</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse the cardinality of a relation</span>

<span class="sd">        Args:</span>
<span class="sd">            graph: underlying ontology graph</span>
<span class="sd">            relation: Relation object into which the information are saved</span>
<span class="sd">            statement: The statement that is actively treated</span>
<span class="sd">            statements: Ontology statements concerning the relation</span>
<span class="sd">            treated_statements: Statements that were already treated</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">Tags</span><span class="o">.</span><span class="n">owl_on_class</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="n">statements</span><span class="p">:</span>
            <span class="n">relation</span><span class="o">.</span><span class="n">restriction_cardinality</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">statements</span><span class="p">[</span><span class="n">statement</span><span class="p">])</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">statements</span><span class="p">[</span><span class="n">Tags</span><span class="o">.</span><span class="n">owl_on_class</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_relation_values</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">relation</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
            <span class="n">treated_statements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">owl_on_class</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Tags</span><span class="o">.</span><span class="n">owl_on_data_range</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="n">statements</span><span class="p">:</span>
            <span class="n">relation</span><span class="o">.</span><span class="n">restriction_cardinality</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">statements</span><span class="p">[</span><span class="n">statement</span><span class="p">])</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">statements</span><span class="p">[</span><span class="n">Tags</span><span class="o">.</span><span class="n">owl_on_data_range</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_relation_values</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">relation</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
            <span class="n">treated_statements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">owl_on_data_range</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># has From:</span>
            <span class="c1"># in File: owl:maxCardinality &quot;1&quot;^^xsd:nonNegativeInteger</span>
            <span class="c1"># e.g.: {&#39;http://www.w3.org/2002/07/owl#maxCardinality&#39;:</span>
            <span class="c1">#        rdflib.term.Literal(&#39;1&#39;, datatype=</span>
            <span class="c1">#        rdflib.term.URIRef(&#39;</span>
            <span class="c1">#        http://www.w3.org/2001/XMLSchema#nonNegativeInteger&#39;))}</span>

            <span class="c1"># in this case the file does not state a datarange that is allowed.</span>
            <span class="c1"># Therefore the target gets set to the universal string</span>

            <span class="n">relation</span><span class="o">.</span><span class="n">restriction_cardinality</span> <span class="o">=</span> <span class="n">statements</span><span class="p">[</span><span class="n">statement</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="n">datatype</span> <span class="o">=</span> <span class="s2">&quot;http://www.w3.org/2001/XMLSchema#string&quot;</span>
            <span class="n">target_statement</span> <span class="o">=</span> <span class="n">TargetStatement</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">StatementType</span><span class="o">.</span><span class="n">LEAF</span><span class="p">,</span>
                                               <span class="n">target_iri</span><span class="o">=</span><span class="n">datatype</span><span class="p">)</span>
            <span class="n">relation</span><span class="o">.</span><span class="n">target_statement</span> <span class="o">=</span> <span class="n">target_statement</span>

    <span class="k">def</span> <span class="nf">_parse_has_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span> <span class="n">relation</span><span class="p">:</span> <span class="n">Relation</span><span class="p">,</span>
                         <span class="n">node</span><span class="p">:</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse the value of a relation</span>

<span class="sd">        Args:</span>
<span class="sd">           graph: underlying ontology graph</span>
<span class="sd">           relation: Relation object into which the information are saved</span>
<span class="sd">           node: (complex) Graph node containing the value</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">           None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_relation_values</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">relation</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
        <span class="c1"># for hasValue only a target-statement that is a leaf is allowed</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">relation</span><span class="o">.</span><span class="n">target_statement</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">StatementType</span><span class="o">.</span><span class="n">LEAF</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_logging_information</span><span class="p">(</span>
                <span class="n">LogLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span>
                <span class="n">IdType</span><span class="o">.</span><span class="n">class_</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_class_iri</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;In hasValue relation with property </span><span class="si">{</span><span class="n">relation</span><span class="o">.</span><span class="n">property_iri</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;target is a complex expression&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_parse_relation_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span>
                               <span class="n">relation</span><span class="p">:</span> <span class="n">Relation</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse the value of a relation out of a node that can be complex;</span>
<span class="sd">        consisting out of a combination of multiple other nodes</span>

<span class="sd">        Args:</span>
<span class="sd">           graph: underlying ontology graph</span>
<span class="sd">           relation: Relation object into which the information are saved</span>
<span class="sd">           node: (complex) Graph node containing the value</span>

<span class="sd">        Returns:</span>
<span class="sd">           None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">target_statement</span> <span class="o">=</span> <span class="n">TargetStatement</span><span class="p">()</span>
        <span class="n">relation</span><span class="o">.</span><span class="n">target_statement</span> <span class="o">=</span> <span class="n">target_statement</span>

        <span class="n">queue</span> <span class="o">=</span> <span class="p">[(</span><span class="n">node</span><span class="p">,</span> <span class="n">target_statement</span><span class="p">)]</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">current_term</span><span class="p">,</span> <span class="n">current_statement</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current_term</span><span class="p">,</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">URIRef</span><span class="p">):</span>
                <span class="n">target_iri</span> <span class="o">=</span> <span class="n">get_iri_from_uriref</span><span class="p">(</span><span class="n">current_term</span><span class="p">)</span>

                <span class="n">current_statement</span><span class="o">.</span><span class="n">set_target</span><span class="p">(</span><span class="n">target_iri</span><span class="o">=</span><span class="n">target_iri</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">owl_intersection</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="ow">in</span> \
                        <span class="n">graph</span><span class="o">.</span><span class="n">predicates</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">current_term</span><span class="p">):</span>

                    <span class="n">current_statement</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">StatementType</span><span class="o">.</span><span class="n">AND</span>
                <span class="k">elif</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">owl_union</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="ow">in</span> \
                        <span class="n">graph</span><span class="o">.</span><span class="n">predicates</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">current_term</span><span class="p">):</span>

                    <span class="n">current_statement</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">StatementType</span><span class="o">.</span><span class="n">OR</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">current_statement</span><span class="o">.</span><span class="n">set_target</span><span class="p">(</span>
                        <span class="n">target_iri</span><span class="o">=</span><span class="s2">&quot;Target statement has no iri&quot;</span><span class="p">,</span>
                        <span class="n">target_data_value</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">current_term</span><span class="p">))</span>

                    <span class="k">continue</span>

                <span class="n">child_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_objects_out_of_single_combination</span><span class="p">(</span>
                    <span class="n">graph</span><span class="p">,</span> <span class="n">current_term</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">child_node</span> <span class="ow">in</span> <span class="n">child_nodes</span><span class="p">:</span>
                    <span class="n">new_statement</span> <span class="o">=</span> <span class="n">TargetStatement</span><span class="p">()</span>
                    <span class="n">current_statement</span><span class="o">.</span><span class="n">target_statements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_statement</span><span class="p">)</span>
                    <span class="n">queue</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">child_node</span><span class="p">,</span> <span class="n">new_statement</span><span class="p">))</span>

    <span class="c1"># an intersection/union is a basic list, it consists out of a chain of</span>
    <span class="c1"># bnode, where each bnode has the &quot;first&quot;and &quot;rest&quot; predicate, first</span>
    <span class="c1"># contains our object, rest is a pointer to the next part of the chain.</span>
    <span class="c1"># the list is over if rest points to &quot;NIL&quot;</span>
    <span class="c1"># this methode extracts all objects of a single layered intersection,</span>
    <span class="c1"># if the intersection contains further intersections these are contained in</span>
    <span class="c1"># the result list as BNode</span>
    <span class="k">def</span> <span class="nf">_extract_objects_out_of_single_combination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span>
                                                   <span class="n">node</span><span class="p">:</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">BNode</span><span class="p">,</span>
                                                   <span class="n">accept_and</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
                                                   <span class="n">accept_or</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
                                                   <span class="n">accept_one_of</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An intersection/union is a basic list, it consits out of a chain of</span>
<span class="sd">        bnode,where each bnode has the &quot;first&quot;and &quot;rest&quot; predicate,</span>
<span class="sd">        first contains our object, rest is a pointer to the next part of the</span>
<span class="sd">        chain. The list is over if rest points to &quot;NIL&quot;</span>
<span class="sd">        This methode extracts all objects of a single layered intersection,</span>
<span class="sd">        if the intersection contains further intersections these are contained</span>
<span class="sd">        in the result list as BNode</span>

<span class="sd">        Args:</span>
<span class="sd">            graph: underlying ontology graph</span>
<span class="sd">            node: (complex) Graph node containing the value</span>
<span class="sd">            accept_or (bool): true, if combinations with &quot;or&quot; are allowed to be</span>
<span class="sd">                parsed</span>
<span class="sd">            accept_and (bool): true, if combinations with &quot;and&quot; are allowed</span>
<span class="sd">                to be parsed</span>
<span class="sd">            accept_one_of (bool): true, if ne_of statements are allowed</span>
<span class="sd">                to be parsed</span>

<span class="sd">        Returns:</span>
<span class="sd">           None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">predicates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">predicates</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">node</span><span class="p">))</span>

        <span class="c1"># the passed startnode needs to contain an intersection or a union</span>
        <span class="c1"># both at the same time should not be possible</span>
        <span class="n">start_node</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">owl_intersection</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> \
                <span class="ow">in</span> <span class="n">predicates</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">accept_and</span><span class="p">:</span>
                <span class="n">start_node</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span>
                    <span class="n">subject</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
                    <span class="n">predicate</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">owl_intersection</span><span class="o">.</span><span class="n">value</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">owl_union</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> \
                <span class="ow">in</span> <span class="n">predicates</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">accept_or</span><span class="p">:</span>
                <span class="n">start_node</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span>
                    <span class="n">subject</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
                    <span class="n">predicate</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">owl_union</span><span class="o">.</span><span class="n">value</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">owl_one_of</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> \
                <span class="ow">in</span> <span class="n">predicates</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">accept_one_of</span><span class="p">:</span>
                <span class="n">start_node</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span>
                    <span class="n">subject</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
                    <span class="n">predicate</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span><span class="n">Tags</span><span class="o">.</span><span class="n">owl_one_of</span><span class="o">.</span><span class="n">value</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_logging_information</span><span class="p">(</span>
                <span class="n">LogLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span> <span class="n">IdType</span><span class="o">.</span><span class="n">class_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_class_iri</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;Intern Error - invalid </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2"> passed to list extraction&quot;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rest</span> <span class="o">=</span> <span class="n">start_node</span>
        <span class="k">if</span> <span class="n">start_node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="n">rest</span> <span class="o">==</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span>
                <span class="s1">&#39;http://www.w3.org/1999/02/22-rdf-syntax-ns#nil&#39;</span><span class="p">):</span>

            <span class="n">first</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">predicate</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span>
                <span class="s1">&#39;http://www.w3.org/1999/02/22-rdf-syntax-ns#first&#39;</span><span class="p">),</span>
                <span class="n">subject</span><span class="o">=</span><span class="n">rest</span><span class="p">))</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">first</span><span class="p">)</span>
            <span class="n">rest</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">predicate</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">(</span>
                        <span class="s1">&#39;http://www.w3.org/1999/02/22-rdf-syntax-ns#rest&#39;</span><span class="p">),</span>
                                      <span class="n">subject</span><span class="o">=</span><span class="n">rest</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_extract_objects_out_of_layered_combination</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">BNode</span><span class="p">,</span>
            <span class="n">accept_and</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">accept_or</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract all nodes out of a complex combination</span>

<span class="sd">        Args:</span>
<span class="sd">            graph: underlying ontology graph</span>
<span class="sd">            node: (complex) Graph node containing the complex combination</span>
<span class="sd">            accept_or (bool): true, if combinations with &quot;or&quot; are allowed to be</span>
<span class="sd">                parsed</span>
<span class="sd">            accept_and (bool): true, if combinations with &quot;and&quot; are allowed</span>
<span class="sd">                to be parsed</span>

<span class="sd">        Returns:</span>
<span class="sd">           List[rdflib.term.URIRef], list of terms out of combination</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">queue</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">]</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">rdflib</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">URIRef</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">queue</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extract_objects_out_of_single_combination</span>
                             <span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">accept_and</span><span class="p">,</span> <span class="n">accept_or</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2024, RWTH Aachen University, E.ON Energy Research Center, Institute for Energy Efficient Buildings and Indoor Climate.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>